# Linux学习（四）文件
## 一、文件属性  
linux中一切皆文件，每个文件都有文件属性和文件名称，文件属性记录了文件的权限、修改时间、创建用户、文件类型等信息，
文件名称标识文件（注意：linux系统的文件后缀名意义不大，不能用于区分文件类型）；通过命令查看具体文件属性：`file xxx`；列出目录中所有文件属性`ls -li dir` 
```  
举例：01     02      03  04   05     06 07  08   09  10
     ......
     17 lrwxrwxrwx.  1 root root     7 Aug 18  2017 bin -> usr/bin
 131074 dr-xr-xr-x.  4 root root  4096 Sep 12  2017 boot
      3 drwxr-xr-x  19 root root  2960 Jul 20 09:40 dev
      ......
```
其中01-09属于文件属性；10是文件名称，具体含义：  
> 01：inode索引节点，用于标识文件  
> 02：[首位]文件类别 + [剩余]文件权限位信息（即用户对该文件的权限）  
> 03：硬连接数，多个文件具有相同的inode,即链接该文件的文件个数  
> 04：文件所属用户，文件的创建者  
> 05：文件所属组，文件所属用户组  
> 06：文件大小  
> 07：文件最后改动时间    

## 二、文件索引  
磁盘格式化的时候，系统会创建文件系统，自动生成许多inode和block，当存储文件时，会取用inode和block与该文件建立联系。
文件属性信息存入inode，文件具体内容存储于block中，文件的名称信息存放在上一级目录的block中。  
> inode：存数数据索引节点，存储文件属性信息，类似于书的目录。  
> block：数据块/存储文件的具体位置，类似于目录对应的具体内容。读写一次block会消耗一次IO。  
> \[拓展\]：当磁盘用来存储大文件时，block设置大点可以提高IO效率，反之，设置小点可以提高空间利用率。  
  
查看磁盘inode使用情况：`df -i`  
查看磁盘block使用情况：`df`
## 三、文件类别与权限  
### 文件类别：  
> d ：目录文件类型  
> －：普通文件。普通文件又分为  
> 　　纯文本(text，可直接编辑查看)  
> 　　binary(命令文件，不可编辑)  
> 　　data(数据文件，压缩文件)  
> l：链接文件，详细介绍见下小结  
> c：串行端口设备，例如键盘、鼠标(一次性读取装置)   
> b：可供储存的接口设备(可随机存取装置)  
> s：socket文件  
  
### 文件权限  
1. 介绍  
   用户对文件的权限分为：  
   1. 读(r-4)，查看文件  
   2. 写(w-2)，修改文件  
   3. 执行(x-1)，对目录包含进入权限，对文件包含执行内容权限  
   4. 无权限（0）  
   5. 特殊权限位：  
   s，setuid，将属主的能力赋予所有用户  
   t，粘滞位，设置了粘滞位后，只有目录内文件的所有者或者root才可以删除或移动该文件。  
     
   可以用数字组合表示，如6代表r+w，7代表具有全部权限r+w+x；  
  
   文件权限有9位(加上粘滞位有12位)，分别表示属主权限（文件所有者），属组权限（和属主在相同组别的用户），其他用户权限  
2. 默认权限  
   + 普通文件默认权限: 644  
   保证属主用户对文件可以编辑  保证其他用户可以读取文件内容（666-umask,奇数位加一）  
   + 目录文件默认权限: 755  
   保证属主用户对目录进行编辑  保证其他用户可以读取目录中的信息,可以进入到目录中,进入目录需要x权限(777-umask)  
   + 补充：  
   文件访问原理：访问文件会从文件目录的根目录依次递归访问对应目录inode，找到block。如果文件夹inode没有x权限，便无法访问该文件夹的block，也无法查看文件夹下的文件属性。  
   当出现目录可读不可执行时，可能出现访问目录下文件属性为？的现象，是因为找不到文件夹的inode，无法访问文件夹的block  
3. 修改文件默认权限  
   ```
   属主-user       u  
   属组-group      g 
   其他用户-other   o
    
   修改文件权限：chmod
       chmod 644 test.txt
       chmod g=rwx test.txt
       chmod u+r test.txt
       chmod 0 test.txt  
   修改文件属主和属组：chown
       chown 新属主.新属组 filename
         -R ：递归修改目录下所有文件
   ```
4. 文件加锁：`chattr +i filename`  
   文件解锁：`chattr -i filename`  
   
  
    
## 四、文件链接  
### 硬链接  
1. 一个分区中，相同inode的文件，即多个指向同一block的、具有相同inode的文件。但系统中的目录不能创建硬链接（因为目录可用于挂载，内存除外）。硬链接可以用来文件误删除恢复（cp能防止误修改）。  
2. 链接与源文件inode相同，权限相同，源文件失效后，硬链接依然有效。可通过find命令`-inum`查找硬链接文件  
3. 创建硬链接：`ln 文件名 连接名`
### 软连接  
1. 存放指向源文件的路径信息，可理解为快捷方式。文件名称会以'=>'标识，链接与源文件inode不相同，权限不相同，源文件失效后，软连接失效。  
2. 创建软链接：`ln -s 文件名 连接名`（最好采用绝对路径，否则容易失效）  
## 五、文件时间  
查看文件修改时间（mtime）,访问时间（atime）,改变时间（ctime）命令：`stat file`  
> **ctime**: （change time）显示的是文件的权限、拥有者、所属的组、链接数发
  生改变时的时间。当然当内容改变时也会随之改变（即inode内容发生改变和Block内容发生改变时）  
> **mtime**: （modify time）显示的是文件内容被修改的最后时间，比如用vi编辑  
  
查看系统时间命令：  
```
date：                        :查看系统当前时间
date "+%y-%m-%d %H:%M:%S"     :标准化时间
date -s '2011/11/11 11:11:11' :设置时间
date -d '+nday'               :查看加n天后的时间 
```
## 六、文件命令  
简单基础命令参考系列（零）命令手册  
### find查找命令  
用于查找具体目录下的某个文件  
> find　目录　-type　文件类型　-name　"文件名"，借助*可实现模糊查找  
> 参数：-iname　可实现文件名忽略大小写  
> 参数：-maxdepth　指定递归查找的最大目录层级数  
> 参数：-delete　找出后删除  
> 参数：-perm　按权限查看  
> 参数：-mtime　按时间查看（10：往前的第10天，+10：10天前所有，-10：最近的10天内所有）  
> 参数：-size　可实现按大小查找，常见单位：c(byte),k(km),M(Mb)  
  
### tree目录结构   
有时候我们需要显示目录的结构，又不想太详细，只是简单查看大体有什么文件，这时候可以使用tree命令  
> 注意：tree系统不自带，需要安装  
> tree dir　　　　　：列出dir目录下的文件树结构  
> 　　　-d　　　　 ：只显示目录  
> 　　　-L 数字　　：指定文件树最大深度，即最大目录层级  
  
### tar文件压缩  
将长期不使用但又有价值的文件压缩，节省空间  
> tar　zcvf　压缩文件名　要压缩的文件 => 压缩命令  
> tar　xvf　压缩文件名 => 解压命令   
> 　　z　压缩的方式 为zip     
> 　　c　创建压缩包文件  
> 　　x　解压内容  
> 　　v　显示压缩的过程  
> 　　f　指定压缩包文件路径信息  
> 　　--exclude=filename　指定压缩不包括某文件  
>注意：在指定文件路径时统一使用绝对或者相对路径，否则可能造成解压过程出错
   
 
